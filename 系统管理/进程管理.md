## 进程管理的作用

1.  判断服务器健康状态
2.  查看系统中所有进程
3.  杀死进程

```bash
ps aux
# 查看系统中所有进程，使用BSD操作系统格式
ps -le
# 查看系统中所有进程，使用Linux标准命令格式
```

### 选项

| 选项 | 备注                                 |
| ---- | ------------------------------------ |
| a    | 显示一个终端的所有进程，除了回话引线 |
| u    | 显示进程的归属用户及内存的使用情况   |
| x    | 显示没有控制终端的进程               |
| -l   | 长格式显示。显示更加详细的信息       |
| -e   | 显示所有进程，和-A 作用一致          |

## ps 命令的输出

| 选项    | 备注                                                                                                                            |
| ------- | ------------------------------------------------------------------------------------------------------------------------------- |
| USER    | 改进程是由哪个用户产生的                                                                                                        |
| PID     | 进程的 ID 号                                                                                                                    |
| %CPU    | 该进程占用 CPU 资源的百分比，占用越高，进程越耗费资源                                                                           |
| %MEM    | 该进程占用物理内存的百分比，占用越高，进程越耗费资源                                                                            |
| VSZ     | 该进程占用虚拟内存的大小，单位 KB                                                                                               |
| RSS     | 该进程占用实际物理内存的大小，单位 KB                                                                                           |
| TTY     | 该进程是在哪个终端运行的。其中 tty1 代表本地控制台终端，tty1-tty6 是本地的字符界面终端，tty7 是图形终端。pts/0-255 代表虚拟终端 |
| STAT    | 进程状态。                                                                                                                      |
| START   | 该进程的启动时间                                                                                                                |
| TIME    | 该进程占用 CPU 的运算时间，注意不是系统时间                                                                                     |
| COMMAND | 产生此进程的命令名                                                                                                              |

### 常见的进程状态

| STAT |            |
| ---- | ---------- |
| R    | 运行       |
| S    | 睡眠       |
| T    | 停止状态   |
| s    | 包含子进程 |
| +    | 位于后台   |

## 查看进程树

```bash
pstree [选项]
```

### 选项

| 选项 | 备注               |
| ---- | ------------------ |
| -p   | 显示进程的 PID     |
| -u   | 显示进程的所属用户 |

## 查看系统健康状态

```bash
top [选项]
```

### 选项

| 选项 | 备注                                              |
| ---- | ------------------------------------------------- |
| -d   | 秒数：指定 top 命令每个几秒更新。默认是 3 秒      |
| -b   | 使用批处理模式输出。一般和'-n'选项合用            |
| -n   | 次数：指定 top 命令执行的次数。一般和选项'-b'合用 |

### 在 top 命令的交互模式当中可以执行的命令

| 选项  | 备注                            |
| ----- | ------------------------------- |
| ?或 h | 显示交互模式的帮助              |
| P     | 以 CPU 使用率排序，默认就是此项 |
| M     | 以内存的使用率排序              |
| N     | 以 PID 排序                     |
| q     | 退出 top                        |

e.g.

```bash
top -d 1
top -b -n 1 > /root/top.log
```

## kill 命令

- 按照进程号杀死进程

```bash
kill -l
# 查看可用的进程信号
kill -HUP 服务进程号PID
# 平滑重启
```

### 选项

| 信号代号 | 信号名称 | 说明                                                                                                                                     |
| -------- | -------- | ---------------------------------------------------------------------------------------------------------------------------------------- |
| 1        | SIGHUP   | 该信号让进程立即关闭，然后重新读取配置文件之后重启                                                                                       |
| 2        | SIGINT   |                                                                                                                                          |
| 8        | SIGFPE   |                                                                                                                                          |
| 9        | SIGKILL  | 用来立即结束程序的运行，本信号不能被阻塞、除了和忽略。一般用于强制终止进程。                                                             |
| 14       | SIGALRM  |                                                                                                                                          |
| 15       | SIGTERM  | 正常结束进程的信号，kill 命令的默认信号。有时如果进程已经发生问题，这个信号是无法正常终止进程的，我们才会尝试 SIGKILL 信号，也就是信号 9 |
| 18       | SIGCONT  |                                                                                                                                          |
| 19       | SIGSTOP  |                                                                                                                                          |

e.g.

```bash
kill -1 2235
# 重启进程
kill -9 2236
# 强制杀死进程
```

## kilalll 命令

- 按照进程名杀死进程

```bash
killall [选项][信号] 进程名
```

### 选项

| 选项 | 备注                           |
| ---- | ------------------------------ |
| -i   | 交互式，询问是否要杀死某个进程 |
| -I   | 忽略进程名的大小写             |

e.g.

```bash
killall -9 httpd
ps aux | grep httpd
killall -i -9 httpd
```

## pkill 命令

- 按照进程名终止进程

```bash
pkill [选项][信号] 进程名
```

### 选项

| 选项 | 备注                       |
| ---- | -------------------------- |
| -t   | 终端号：按照终端号踢出用户 |

```bash
w
# 查看当前登录用户
pkill -9 -t tty1
# 踢出登录用户tty1
# -9和-t不能写反
```
